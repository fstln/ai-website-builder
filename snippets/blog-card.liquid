{% comment %}
  Blog/Article Card Component
  Displays a blog article in card format
  视觉规范: visual_spec.md
  
  Usage:
    {% render 'blog-card', article: article %}
    {% render 'blog-card', article: article, show_excerpt: true, image_ratio: '16:9' %}
  
  Parameters:
    - article: Article object (required)
    - show_excerpt: Show article excerpt (default: true)
    - show_author: Show article author (default: true)
    - show_date: Show publish date (default: true)
    - show_tags: Show article tags (default: false)
    - image_ratio: Image aspect ratio - '1:1', '4:3', '16:9' (default: '16:9')
    - class: Additional CSS classes
{% endcomment %}

{%- liquid
  assign display_excerpt = show_excerpt | default: true
  assign display_author = show_author | default: true
  assign display_date = show_date | default: true
  assign display_tags = show_tags | default: false
  assign img_ratio = image_ratio | default: '16:9'
-%}

{%- comment -%} DTC 设计：简洁无边框，3:2 图片比例，靠间距传达层级 {%- endcomment -%}
<article class="blog-card group {{ class }}">
  <a href="{{ article.url }}" class="block">
    {%- comment -%} Article Image - DTC 设计：固定 3:2 比例，8px 圆角（清晰锐利）{%- endcomment -%}
    {% if article.image %}
      <div class="blog-card-image relative overflow-hidden bg-border/20 aspect-[3/2] rounded-lg mb-3">
        {% render 'image', 
          image: article.image, 
          alt: article.image.alt | default: article.title,
          class: 'w-full h-full object-cover group-hover:scale-105 transition-transform duration-300'
        %}
        
        {%- comment -%} Reading time badge (optional) - pill shape {%- endcomment -%}
        {% if article.content != blank %}
          {%- assign word_count = article.content | strip_html | split: ' ' | size -%}
          {%- assign reading_time = word_count | divided_by: 200 | at_least: 1 -%}
          <div class="absolute bottom-2 right-2 bg-text/80 backdrop-blur-sm text-white text-xs font-medium px-2.5 py-1 rounded-full">
            {{ 'blogs.article.read_time' | t: time: reading_time }}
          </div>
        {% endif %}
      </div>
    {% else %}
      {%- comment -%} Placeholder if no image - 匹配图片圆角 {%- endcomment -%}
      <div class="blog-card-image aspect-[3/2] flex items-center justify-center bg-border/20 rounded-lg mb-3">
        {% render 'icon', name: 'document', class: 'w-16 h-16 text-foreground-secondary/60' %}
      </div>
    {% endif %}
    
    {%- comment -%} Article Info - DTC 设计：内容与图片对齐，无内边距 {%- endcomment -%}
    <div class="blog-card-info">
      {%- comment -%} Tags - 如果有，最顶部 {%- endcomment -%}
      {% if display_tags and article.tags.size > 0 %}
        <div class="blog-card-tags flex flex-wrap gap-1.5 mb-2">
          {% for tag in article.tags limit: 2 %}
            <span class="inline-flex items-center text-xs font-medium px-2.5 py-1 bg-primary/10 text-primary rounded-full">
              {{ tag }}
            </span>
          {% endfor %}
        </div>
      {% endif %}
      
      {%- comment -%} Title - Tailwind 原生：text-xl font-semibold {%- endcomment -%}
      <h3 class="blog-card-title text-xl font-semibold mb-1.5 line-clamp-2 text-foreground group-hover:text-primary transition-colors">
        {{ article.title }}
      </h3>
      
      {%- comment -%} Meta - Tailwind 原生：text-xs font-medium，与标题紧密关联 {%- endcomment -%}
      {% if display_author or display_date %}
        <div class="blog-card-meta text-xs font-medium text-foreground-secondary mb-2 flex items-center gap-1.5">
          {% if display_author and article.author != blank %}
            <span>{{ article.author }}</span>
          {% endif %}
          
          {% if display_author and display_date and article.author != blank %}
            <span class="text-foreground-secondary/70">·</span>
          {% endif %}
          
          {% if display_date %}
            <time datetime="{{ article.published_at | date: '%Y-%m-%d' }}">
              {{ article.published_at | date: '%B %d, %Y' }}
            </time>
          {% endif %}
        </div>
      {% endif %}
      
      {%- comment -%} Excerpt - Tailwind 原生：text-sm leading-relaxed {%- endcomment -%}
      {% if display_excerpt %}
        {% if article.excerpt != blank %}
          <p class="blog-card-excerpt text-sm leading-relaxed text-foreground-secondary mb-3 line-clamp-3">
            {{ article.excerpt | strip_html }}
          </p>
        {% elsif article.content != blank %}
          <p class="blog-card-excerpt text-sm leading-relaxed text-foreground-secondary mb-3 line-clamp-3">
            {{ article.content | strip_html | truncate: 150 }}
          </p>
        {% endif %}
      {% endif %}
      
      {%- comment -%} Read More - Tailwind 原生：text-sm font-semibold {%- endcomment -%}
      <span class="blog-card-link text-sm font-semibold text-primary group-hover:text-primary/80 inline-flex items-center gap-1.5 transition-colors">
        <span>{{ 'blogs.article.read_more' | t }}</span>
        {% render 'icon', name: 'arrow-right', class: 'w-4 h-4 transition-transform group-hover:translate-x-1' %}
      </span>
    </div>
  </a>
  
  {%- comment -%} Comment Count (outside link for better UX) - 独立的元数据区 {%- endcomment -%}
  {% if article.comments_enabled? and article.comments_count > 0 %}
    <div class="blog-card-comments pt-3 border-t border-border">
      <a href="{{ article.url }}#comments" class="text-xs font-medium text-foreground-secondary hover:text-primary flex items-center gap-1.5 transition-colors">
        {% render 'icon', name: 'comment', class: 'w-4 h-4' %}
        <span class="font-medium">{{ 'blogs.article.comments_count' | t: count: article.comments_count }}</span>
      </a>
    </div>
  {% endif %}
</article>
