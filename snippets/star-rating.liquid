{% comment %}
  Star Rating Component
  Displays a visual star rating (5-star system)
  
  Usage:
    {% render 'star-rating', rating: 4.5, count: 128 %}
    {% render 'star-rating', rating: product.metafields.reviews.rating, count: product.metafields.reviews.count %}
  
  Parameters:
    - rating: Rating value (0-5, supports decimals)
    - count: Number of reviews (optional, shows "X reviews" text)
    - show_count: Whether to show review count (default: true if count provided)
    - size: 'sm', 'md', 'lg' (default: 'md')
    - class: Additional CSS classes
{% endcomment %}

{%- liquid
  assign rating_value = rating | default: 0 | times: 1.0
  assign review_count = count | default: 0
  assign display_count = show_count | default: true
  assign star_size = size | default: 'md'

  case star_size
    when 'sm'
      assign size_class = 'w-3 h-3'
    when 'lg'
      assign size_class = 'w-6 h-6'
    else
      assign size_class = 'w-4 h-4'
  endcase

  assign rating_percentage = rating_value | divided_by: 5.0 | times: 100
  assign rating_text = 'accessibility.star_reviews_info' | t: rating_value: rating_value, rating_max: 5
-%}

<div class="star-rating flex items-center gap-2 {{ class }}" role="img" aria-label="{{ rating_text }}">
  <div class="star-rating-stars flex items-center gap-0.5">
    {% for i in (1..5) %}
      {%- liquid
        assign star_fill = 0
        
        if rating_value >= i
          assign star_fill = 100
        elsif rating_value > i | minus: 1
          assign decimal_part = rating_value | modulo: 1
          assign star_fill = decimal_part | times: 100
        endif
      -%}
      
      <div class="star-wrapper relative inline-block {{ size_class }}">
        {%- comment -%} Empty star (background) {%- endcomment -%}
        <svg class="star-empty absolute inset-0 text-border" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
        </svg>
        
        {%- comment -%} Filled star (foreground) {%- endcomment -%}
        <svg class="star-fill absolute inset-0 text-yellow-400" style="clip-path: inset(0 {{ 100 | minus: star_fill }}% 0 0);" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
        </svg>
      </div>
    {% endfor %}
  </div>
  
  {% if display_count and review_count > 0 %}
    <span class="star-rating-count text-sm text-text-secondary">
      ({{ review_count }})
    </span>
  {% elsif rating_value > 0 %}
    <span class="star-rating-value text-sm text-text-secondary">
      {{ rating_value | round: 1 }}
    </span>
  {% endif %}
</div>

