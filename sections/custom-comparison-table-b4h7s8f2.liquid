{%- liquid
  assign section_id = 'comparison-table-' | append: section.id
-%}

<section
  id="{{ section_id }}"
  class="color-scheme color-{{ section.settings.color_scheme }}"
>
  <div class="container-custom py-12 md:py-24">
    <div class="max-w-3xl mx-auto text-center">
      {%- if section.settings.heading != blank -%}
        <h2 class="text-3xl md:text-4xl font-bold tracking-tight text-foreground">
          {{ section.settings.heading }}
        </h2>
      {%- endif -%}

      {%- if section.settings.subheading != blank -%}
        <p class="mt-4 text-lg text-foreground-muted">
          {{ section.settings.subheading }}
        </p>
      {%- endif -%}
    </div>

    <div class="mt-12 overflow-x-auto">
      <table class="min-w-full border-collapse text-left">
        <thead>
          <tr>
            <th class="py-4 pr-6 font-semibold text-foreground">
              {{ section.settings.feature_column_header }}
            </th>
            {%- for block in section.blocks -%}
              {%- if block.type == 'product_column' -%}
                <th
                  class="w-1/4 px-6 py-4 font-semibold text-foreground text-center"
                  {{ block.shopify_attributes }}
                >
                  {{ block.settings.product_name }}
                </th>
              {%- endif -%}
            {%- endfor -%}
          </tr>
        </thead>

        <tbody>
          {%- assign feature_rows = section.blocks | where: "type", "feature_row" -%}
          {%- for row_block in feature_rows -%}
            <tr
              class="border-t border-border"
              {{ row_block.shopify_attributes }}
            >
              <td class="py-5 pr-6 font-medium text-foreground-muted">
                {{ row_block.settings.feature_name }}
              </td>
              {%- for col_block in section.blocks -%}
                {%- if col_block.type == 'product_column' -%}
                  {%- assign col_index = forloop.index -%}
                  {%- assign value_setting_id = "feature_value_" | append: col_index -%}
                  <td class="px-6 py-5 text-center text-foreground">
                    {{ row_block.settings[value_setting_id] }}
                  </td>
                {%- endif -%}
              {%- endfor -%}
            </tr>
          {%- endfor -%}
        </tbody>
      </table>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Comparison Table",
  "tag": "section",
  "class": "custom-comparison-table-section",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Find the Right Fit"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Compare our products at a glance."
    },
    {
      "type": "text",
      "id": "feature_column_header",
      "label": "Feature Column Header",
      "default": "Feature"
    }
  ],
  "blocks": [
    {
      "type": "product_column",
      "name": "Product Column",
      "limit": 3,
      "settings": [
        {
          "type": "text",
          "id": "product_name",
          "label": "Product Name",
          "default": "Product"
        }
      ]
    },
    {
      "type": "feature_row",
      "name": "Feature Row",
      "settings": [
        {
          "type": "text",
          "id": "feature_name",
          "label": "Feature Name",
          "default": "Feature"
        },
        {
          "type": "text",
          "id": "feature_value_1",
          "label": "Product 1 Value",
          "default": "Value"
        },
        {
          "type": "text",
          "id": "feature_value_2",
          "label": "Product 2 Value",
          "default": "Value"
        },
        {
          "type": "text",
          "id": "feature_value_3",
          "label": "Product 3 Value",
          "default": "Value"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Comparison Table",
      "blocks": [
        { "type": "product_column" },
        { "type": "product_column" },
        { "type": "product_column" },
        { "type": "feature_row" },
        { "type": "feature_row" },
        { "type": "feature_row" }
      ]
    }
  ]
}
{% endschema %}
