{%- liquid
  assign section_dom_id = 'social-proof-' | append: section.id
-%}
<section id="{{ section.settings.section_id | default: 'social-proof' }}" class="color-scheme color-{{ section.settings.color_scheme | default: 'scheme-1' }} bg-background" data-section-id="{{ section.id }}" data-section-type="custom-social-proof">
  <style>
    /* Scoped to this section only */
    #{{ section_dom_id }} .star { color: var(--color-primary); }
    #{{ section_dom_id }} blockquote { quotes: "\201C" "\201D"; }
    #{{ section_dom_id }} blockquote:before { content: open-quote; margin-right: .15em; }
    #{{ section_dom_id }} blockquote:after { content: close-quote; margin-left: .05em; }
  </style>

  <div id="{{ section_dom_id }}" class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-12 sm:py-16 lg:py-20">
    <div class="text-center space-y-4 mb-8">
      {%- if section.settings.heading != blank -%}
        <h2 class="text-3xl sm:text-4xl font-bold tracking-tight text-foreground">{{ section.settings.heading | escape }}</h2>
      {%- endif -%}
      <div class="flex items-center justify-center gap-3">
        <div class="flex items-center gap-1" aria-label="{{ section.settings.rating_value | default: 4.9 }} out of {{ section.settings.rating_max | default: 5 }} stars">
          {%- assign rounded = section.settings.rating_value | default: 4.9 | round -%}
          {%- for i in (1..rounded) -%}
            <span class="star" aria-hidden="true">★</span>
          {%- endfor -%}
          {%- assign empty = section.settings.rating_max | default: 5 | minus: rounded -%}
          {%- if empty > 0 -%}
            {%- for i in (1..empty) -%}
              <span class="text-foreground/30" aria-hidden="true">☆</span>
            {%- endfor -%}
          {%- endif -%}
        </div>
        <span class="text-2xl font-bold text-foreground">{{ section.settings.rating_value | default: 4.9 }}</span>
        <span class="text-muted">/ {{ section.settings.rating_max | default: 5 }}</span>
      </div>
      {%- if section.settings.subtitle != blank -%}
        <div class="text-muted">{{ section.settings.subtitle }}</div>
      {%- endif -%}
    </div>

    {%- if section.blocks.size > 0 -%}
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 lg:gap-8">
        {%- for block in section.blocks -%}
          {%- if block.type == 'review' -%}
            <article class="bg-surface text-foreground rounded-xl shadow-sm p-6 flex flex-col" {{ block.shopify_attributes }}>
              <div class="flex items-center gap-4 mb-4">
                {%- if block.settings.avatar != blank -%}
                  <img
                    src="{{ block.settings.avatar | image_url: width: 160 }}"
                    alt="{{ block.settings.avatar_alt | default: block.settings.name | escape }}"
                    class="w-16 h-16 rounded-full object-cover border border-border"
                    loading="lazy" decoding="async">
                {%- else -%}
                  <img
                    src="https://placehold.co/64x64/cccccc/ffffff?text=AV"
                    alt="{{ block.settings.avatar_alt | default: 'Avatar placeholder' | escape }}"
                    class="w-16 h-16 rounded-full object-cover border border-border"
                    loading="lazy" decoding="async">
                {%- endif -%}
                <div>
                  <h3 class="text-base font-semibold text-foreground">{{ block.settings.name | default: 'Reviewer Name' | escape }}</h3>
                  <div class="flex gap-1 mt-1" aria-label="{{ block.settings.stars | default: 5 }} stars">
                    {%- for i in (1..block.settings.stars) -%}
                      <span class="star" aria-hidden="true">★</span>
                    {%- endfor -%}
                    {%- assign remainder = 5 | minus: block.settings.stars -%}
                    {%- if remainder > 0 -%}
                      {%- for i in (1..remainder) -%}
                        <span class="text-foreground/30" aria-hidden="true">☆</span>
                      {%- endfor -%}
                    {%- endif -%}
                  </div>
                </div>
              </div>

              {%- if block.settings.quote != blank -%}
                <blockquote class="text-base leading-relaxed text-foreground/80">{{ block.settings.quote }}</blockquote>
              {%- endif -%}

              {%- if block.settings.verified -%}
                <div class="flex items-center gap-2 mt-6 text-sm text-muted">
                  <span aria-hidden="true">✔</span>
                  <span>{{ block.settings.verified_label | default: 'Verified Purchase' }}</span>
                </div>
              {%- endif -%}
            </article>
          {%- endif -%}
        {%- endfor -%}
      </div>
    {%- endif -%}
  </div>
</section>

{% schema %}
{
  "name": "C: Social Proof",
  "settings": [
    { "type": "color_scheme", "id": "color_scheme", "label": "Color scheme", "default": "scheme-1" },
    { "type": "text", "id": "section_id", "label": "Section ID", "default": "social-proof" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Hear the Echoes of Excellence" },
    { "type": "range", "id": "rating_value", "min": 0, "max": 5, "step": 0.1, "label": "Rating value", "default": 4.9 },
    { "type": "number", "id": "rating_max", "label": "Max rating", "default": 5 },
    { "type": "number", "id": "rating_count", "label": "Rating count", "default": 2847 },
    { "type": "richtext", "id": "subtitle", "label": "Subtitle", "default": "<p>Based on 2,847 reviews</p>" }
  ],
  "blocks": [
    {
      "type": "review",
      "name": "Review",
      "settings": [
        { "type": "image_picker", "id": "avatar", "label": "Avatar" },
        { "type": "text", "id": "avatar_alt", "label": "Avatar alt", "default": "Reviewer avatar" },
        { "type": "text", "id": "name", "label": "Reviewer name", "default": "Reviewer Name" },
        { "type": "range", "id": "stars", "min": 1, "max": 5, "step": 1, "label": "Stars", "default": 5 },
        { "type": "richtext", "id": "quote", "label": "Quote", "default": "<p>Your review goes here. It was amazing!</p>" },
        { "type": "checkbox", "id": "verified", "label": "Show Verified badge", "default": true },
        { "type": "text", "id": "verified_label", "label": "Verified label", "default": "Verified Purchase" }
      ]
    }
  ],
  "presets": [
    { "name": "C: Social Proof" }
  ]
}
{% endschema %}
