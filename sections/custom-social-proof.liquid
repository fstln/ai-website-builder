{%- comment -%}
  This is a robust, configurable social proof section.
  - It uses section settings for the main header content.
  - It uses two distinct block types for reviews and media logos.
  - All content is editable through the Shopify Theme Editor.
  - Hardcoded styles have been replaced with utility classes and CSS variables.
{%- endcomment -%}

{%- liquid
  assign section_id = 'section-' | append: section.id
  assign reviews = ''
  assign logos = ''

  for block in section.blocks
    if block.type == 'review_card'
      assign reviews = reviews | append: block.id
    elsif block.type == 'media_logo'
      assign logos = logos | append: block.id
    endif
  endfor
-%}

{%- capture star_svg -%}
  <svg class="w-full h-full" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12.0006 18.26L4.94715 22.2082L6.52248 14.2799L0.587891 8.7918L8.61483 7.84006L12.0006 0.5L15.3864 7.84006L23.4133 8.7918L17.4787 14.2799L19.054 22.2082L12.0006 18.26Z"></path></svg>
{%- endcapture -%}

<section
  id="{{ section_id }}"
  class="py-16 lg:py-24 bg-white text-gray-900"
  data-section-id="{{ section.id }}"
  data-section-type="social-proof"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    {%- comment -%} Header {%- endcomment -%}
    <div class="text-center mb-12 lg:mb-16">
      {%- if section.settings.heading != blank -%}
        <h2 class="text-3xl sm:text-4xl lg:text-5xl font-bold mb-4">
          {{ section.settings.heading }}
        </h2>
      {%- endif -%}

      <div class="flex items-center justify-center gap-2 mb-2">
        <div class="flex gap-1 text-blue-500">
          <div class="w-6 h-6">{{ star_svg }}</div>
          <div class="w-6 h-6">{{ star_svg }}</div>
          <div class="w-6 h-6">{{ star_svg }}</div>
          <div class="w-6 h-6">{{ star_svg }}</div>
          <div class="w-6 h-6">{{ star_svg }}</div>
        </div>
        {%- if section.settings.rating_value != blank -%}
          <span class="text-lg font-semibold">{{ section.settings.rating_value }}</span>
        {%- endif -%}
      </div>

      {%- if section.settings.rating_count_text != blank -%}
        <p class="text-gray-600">{{ section.settings.rating_count_text }}</p>
      {%- endif -%}
    </div>

    {%- comment -%} Reviews Grid {%- endcomment -%}
    {%- if reviews != blank -%}
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 lg:gap-8 mb-16">
        {%- for block in section.blocks -%}
          {%- if block.type == 'review_card' -%}
            <div
              class="bg-white rounded-3xl p-8 shadow-xl hover:shadow-2xl transition-shadow duration-300 border border-gray-100"
              {{ block.shopify_attributes }}
            >
              <div class="flex gap-1 mb-4 text-blue-500">
                {%- for i in (1..block.settings.rating) -%}
                  <div class="w-5 h-5">{{ star_svg }}</div>
                {%- endfor -%}
              </div>

              {%- if block.settings.quote != blank -%}
                <div class="text-gray-700 text-base leading-relaxed mb-6">
                  {{ block.settings.quote }}
                </div>
              {%- endif -%}

              <div class="flex items-center gap-4">
                {%- if block.settings.author_image != blank -%}
                  {{ block.settings.author_image | image_url: width: 96 | image_tag: class: 'w-12 h-12 rounded-full object-cover', widths: '48, 96', alt: block.settings.author_image.alt | default: block.settings.author_name }}
                {%- else -%}
                  <img src="https://placehold.co/96x96/A8B8FF/333333?text=AV" alt="" class="w-12 h-12 rounded-full" />
                {%- endif -%}
                <div>
                  {%- if block.settings.author_name != blank -%}
                    <div class="font-semibold text-gray-900">{{ block.settings.author_name }}</div>
                  {%- endif -%}
                  {%- if block.settings.author_title != blank -%}
                    <div class="text-sm text-gray-500">{{ block.settings.author_title }}</div>
                  {%- endif -%}
                </div>
              </div>
            </div>
          {%- endif -%}
        {%- endfor -%}
      </div>
    {%- endif -%}

    {%- comment -%} Media Logos {%- endcomment -%}
    {%- if logos != blank -%}
      <div class="text-center">
        {%- if section.settings.featured_in_text != blank -%}
          <p class="text-sm text-gray-500 uppercase tracking-wider mb-8 font-semibold">
            {{ section.settings.featured_in_text }}
          </p>
        {%- endif -%}
        <div class="flex flex-wrap items-center justify-center gap-8 lg:gap-16">
          {%- for block in section.blocks -%}
            {%- if block.type == 'media_logo' -%}
              <div {{ block.shopify_attributes }}>
                {%- liquid
                  assign has_link = false
                  if block.settings.logo_link != blank
                    assign has_link = true
                  endif
                -%}
                {%- if has_link -%}
                  <a href="{{ block.settings.logo_link }}" class="block">
                {%- endif -%}

                {%- if block.settings.logo_image != blank -%}
                  {{ block.settings.logo_image | image_url: width: 320 | image_tag: class: 'h-8 lg:h-10 opacity-60 hover:opacity-100 transition-opacity duration-300 grayscale hover:grayscale-0', widths: '160, 320', alt: block.settings.logo_image.alt | default: 'Media logo' }}
                {%- else -%}
                  <img src="https://placehold.co/160x48/333333/ffffff?text=Logo" alt="Placeholder logo" class="h-8 lg:h-10 opacity-60" />
                {%- endif -%}

                {%- if has_link -%}
                  </a>
                {%- endif -%}
              </div>
            {%- endif -%}
          {%- endfor -%}
        </div>
      </div>
    {%- endif -%}
  </div>
</section>

{% schema %}
{
  "name": "C: Social Proof",
  "class": "shopify-section-social-proof",
  "tag": "section",
  "settings": [
    {
      "type": "header",
      "content": "Section Header"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Trusted by Audio Enthusiasts"
    },
    {
      "type": "text",
      "id": "rating_value",
      "label": "Rating Value Text",
      "default": "4.9/5.0"
    },
    {
      "type": "text",
      "id": "rating_count_text",
      "label": "Rating Count Text",
      "default": "Based on 12,847+ verified reviews"
    },
    {
      "type": "header",
      "content": "Media Logos"
    },
    {
      "type": "text",
      "id": "featured_in_text",
      "label": "'Featured In' Text",
      "default": "Featured In"
    }
  ],
  "blocks": [
    {
      "type": "review_card",
      "name": "Review Card",
      "limit": 6,
      "settings": [
        {
          "type": "range",
          "id": "rating",
          "label": "Star Rating",
          "min": 1,
          "max": 5,
          "step": 1,
          "unit": "s",
          "default": 5
        },
        {
          "type": "richtext",
          "id": "quote",
          "label": "Quote",
          "default": "<p>The sound quality is absolutely phenomenal. I've tried dozens of earbuds, but the open-ear design combined with crystal-clear audio is unmatched.</p>"
        },
        {
          "type": "image_picker",
          "id": "author_image",
          "label": "Author Image"
        },
        {
          "type": "text",
          "id": "author_name",
          "label": "Author Name",
          "default": "Sarah J."
        },
        {
          "type": "text",
          "id": "author_title",
          "label": "Author Title",
          "default": "Verified Buyer"
        }
      ]
    },
    {
      "type": "media_logo",
      "name": "Media Logo",
      "limit": 8,
      "settings": [
        {
          "type": "image_picker",
          "id": "logo_image",
          "label": "Logo Image"
        },
        {
          "type": "url",
          "id": "logo_link",
          "label": "Link (Optional)",
          "default": "/"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "C: Social Proof",
      "blocks": [
        {
          "type": "review_card"
        },
        {
          "type": "review_card",
          "settings": {
            "quote": "<p>Perfect for my morning runs. I can still hear traffic while enjoying my music. The battery life easily lasts my entire week of workouts.</p>",
            "author_name": "Marcus C."
          }
        },
        {
          "type": "review_card",
          "settings": {
            "quote": "<p>Game-changer for long calls. No ear fatigue, incredible comfort, and my colleagues say I sound clearer than ever. Worth every penny.</p>",
            "author_name": "Emily K."
          }
        },
        {
          "type": "media_logo"
        },
        {
          "type": "media_logo"
        },
        {
          "type": "media_logo"
        },
        {
          "type": "media_logo"
        }
      ]
    }
  ]
}
{% endschema %}
