{%- comment -%}
  Generic Compare section for reuse across pages.
  - Block-based rows for flexible feature comparisons.
{%- endcomment -%}

{%- liquid
  assign fallback_section_id = 'compare-' | append: section.index
  assign section_id = section.settings.section_id | default: fallback_section_id
-%}

<section id="{{ section_id | escape }}" class="color-scheme color-{{ section.settings.color_scheme }} bg-background py-16 sm:py-20 lg:py-24">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="mx-auto max-w-2xl lg:text-center">
      <h2 class="text-3xl font-bold tracking-tight text-foreground sm:text-4xl font-heading">
        {{ section.settings.heading }}
      </h2>
      <p class="mt-6 text-lg leading-8 text-muted">
        {{ section.settings.subheading }}
      </p>
    </div>
    {%- liquid
      assign p1 = section.settings.product_col1
      assign p2 = section.settings.product_col2
      assign p3 = section.settings.product_col3
      assign show_cards = section.settings.show_product_cards
    -%}
    {%- if p1 == blank and product -%}
      {%- assign p1 = product -%}
    {%- endif -%}
    {%- if show_cards -%}
      <div class="mt-12">
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
          {%- if p1 -%}
            <div class="rounded-xl border border-border/60 bg-surface p-5 text-center">
              <div class="aspect-[4/3] rounded-lg overflow-hidden bg-background/60 flex items-center justify-center">
                {%- if p1.featured_media -%}
                  <img src="{{ p1.featured_media | image_url: width: 640 }}" alt="{{ p1.featured_media.alt | default: p1.title | escape }}" class="h-full w-full object-cover" loading="lazy" decoding="async">
                {%- else -%}
                  <div class="text-sm text-muted">No image</div>
                {%- endif -%}
              </div>
              <h3 class="mt-4 font-heading text-lg font-semibold text-foreground">{{ p1.title | default: section.settings.col1_fallback_label | default: 'OWS Pro' }}</h3>
              {%- if p1.url -%}
                <a href="{{ p1.url }}" class="btn btn-primary mt-3 inline-flex items-center justify-center">{{ section.settings.buy_now_label | default: 'Buy now' }}</a>
              {%- endif -%}
            </div>
          {%- endif -%}
          {%- if p2 -%}
            <div class="rounded-xl border border-border/60 bg-surface p-5 text-center">
              <div class="aspect-[4/3] rounded-lg overflow-hidden bg-background/60 flex items-center justify-center">
                {%- if p2.featured_media -%}
                  <img src="{{ p2.featured_media | image_url: width: 640 }}" alt="{{ p2.featured_media.alt | default: p2.title | escape }}" class="h-full w-full object-cover" loading="lazy" decoding="async">
                {%- else -%}
                  <div class="text-sm text-muted">No image</div>
                {%- endif -%}
              </div>
              <h3 class="mt-4 font-heading text-lg font-semibold text-foreground">{{ p2.title | default: section.settings.col2_fallback_label | default: 'OWS 2' }}</h3>
              {%- if p2.url -%}
                <a href="{{ p2.url }}" class="btn btn-primary mt-3 inline-flex items-center justify-center">{{ section.settings.buy_now_label | default: 'Buy now' }}</a>
              {%- endif -%}
            </div>
          {%- endif -%}
          {%- if p3 -%}
            <div class="rounded-xl border border-border/60 bg-surface p-5 text-center">
              <div class="aspect-[4/3] rounded-lg overflow-hidden bg-background/60 flex items-center justify-center">
                {%- if p3.featured_media -%}
                  <img src="{{ p3.featured_media | image_url: width: 640 }}" alt="{{ p3.featured_media.alt | default: p3.title | escape }}" class="h-full w-full object-cover" loading="lazy" decoding="async">
                {%- else -%}
                  <div class="text-sm text-muted">No image</div>
                {%- endif -%}
              </div>
              <h3 class="mt-4 font-heading text-lg font-semibold text-foreground">{{ p3.title | default: section.settings.col3_fallback_label | default: 'OWS 1' }}</h3>
              {%- if p3.url -%}
                <a href="{{ p3.url }}" class="btn btn-primary mt-3 inline-flex items-center justify-center">{{ section.settings.buy_now_label | default: 'Buy now' }}</a>
              {%- endif -%}
            </div>
          {%- endif -%}
        </div>
      </div>
    {%- endif -%}
    <div class="mt-16 sm:mt-12 lg:mt-18">
      <div class="rounded-[2.5rem] bg-surface/90 p-6">
        <div class="-mx-2 overflow-x-auto sm:-mx-4">
          <table class="w-full border-collapse text-left">
            <thead class="text-sm font-semibold text-muted">
              <tr class="bg-surface/80">
                <th scope="col" class="px-5 py-5 text-left text-base font-semibold uppercase text-foreground sm:pl-4">
                  <span class="inline-flex items-center rounded-full text-base font-semibold text-primary">
                    {%- if p1 and p1.title != blank -%}
                      {{ p1.title }}
                    {%- else -%}
                      {{ section.settings.col1_fallback_label | default: 'OWS Pro' }}
                    {%- endif -%}
                  </span>
                </th>
                <th scope="col" class="px-5 py-5 text-center text-base font-semibold uppercase text-foreground">
                  {%- if p2 and p2.title != blank -%}
                    {{ p2.title }}
                  {%- else -%}
                    {{ section.settings.col2_fallback_label | default: 'OWS 2' }}
                  {%- endif -%}
                </th>
                <th scope="col" class="px-5 py-5 text-center text-base font-semibold uppercase text-foreground">
                  {%- if p3 and p3.title != blank -%}
                    {{ p3.title }}
                  {%- else -%}
                    {{ section.settings.col3_fallback_label | default: 'OWS 1' }}
                  {%- endif -%}
                </th>
              </tr>
            </thead>
            <tbody class="text-base text-muted">
              {%- for block in section.blocks -%}
                <tr class="border-b border-border/60 last:border-b-0 transition-colors hover:bg-surface/60" {{ block.shopify_attributes }}>
                  <td class="px-5 py-6 text-left align-top sm:pl-4">
                    {%- if block.settings.feature_name != blank -%}
                      <div class="text-xs font-semibold uppercase tracking-wide text-muted">{{ block.settings.feature_name }}</div>
                    {%- endif -%}
                    <div class="mt-3 text-lg font-semibold text-primary">{{ block.settings.owspro_value }}</div>
                  </td>
                  <td class="whitespace-nowrap px-5 py-6 text-lg text-foreground text-center">{{ block.settings.ows2_value }}</td>
                  <td class="whitespace-nowrap px-5 py-6 text-lg text-foreground text-center">{{ block.settings.ows1_value }}</td>
                </tr>
              {%- endfor -%}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Compare",
  "tag": "section",
  "class": "compare-section",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "scheme-1"
    },
    {
      "type": "text",
      "id": "section_id",
      "label": "Section ID",
      "info": "Used for anchor links. Defaults to compare-{index} when left blank."
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Compare Our Models"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Find the perfect Oladance for your lifestyle."
    },
    { "type": "header", "content": "Products" },
    {
      "type": "product",
      "id": "product_col1",
      "label": "Column 1 product (e.g. OWS Pro)"
    },
    {
      "type": "product",
      "id": "product_col2",
      "label": "Column 2 product (e.g. OWS 2)"
    },
    {
      "type": "product",
      "id": "product_col3",
      "label": "Column 3 product (optional)"
    },
    {
      "type": "checkbox",
      "id": "show_product_cards",
      "label": "Show product cards (image + Buy now)",
      "default": true
    },
    {
      "type": "text",
      "id": "buy_now_label",
      "label": "Buy now button label",
      "default": "Buy now"
    },
    { "type": "header", "content": "Fallback labels" },
    { "type": "text", "id": "col1_fallback_label", "label": "Column 1 fallback label", "default": "OWS Pro" },
    { "type": "text", "id": "col2_fallback_label", "label": "Column 2 fallback label", "default": "OWS 2" },
    { "type": "text", "id": "col3_fallback_label", "label": "Column 3 fallback label", "default": "OWS 1" }
  ],
  "blocks": [
    {
      "type": "comparison_row",
      "name": "Comparison Row",
      "settings": [
        {
          "type": "text",
          "id": "feature_name",
          "label": "Feature Name",
          "default": "Bluetooth Version"
        },
        {
          "type": "text",
          "id": "ows1_value",
          "label": "OWS 1 Value",
          "default": "5.2"
        },
        {
          "type": "text",
          "id": "ows2_value",
          "label": "OWS 2 Value",
          "default": "5.3"
        },
        {
          "type": "text",
          "id": "owspro_value",
          "label": "OWS Pro Value",
          "default": "5.3"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Compare",
      "blocks": [
        {
          "type": "comparison_row",
          "settings": {
            "feature_name": "Driver Size",
            "ows1_value": "16.5mm (x2)",
            "ows2_value": "16.5mm (x2)",
            "owspro_value": "23mm*10mm"
          }
        },
        {
          "type": "comparison_row",
          "settings": {
            "feature_name": "Battery Life (Earphones)",
            "ows1_value": "16 hours",
            "ows2_value": "19 hours",
            "owspro_value": "16 hours"
          }
        },
        {
          "type": "comparison_row",
          "settings": {
            "feature_name": "Total Battery Life (with Case)",
            "ows1_value": "Not specified",
            "ows2_value": "Not specified",
            "owspro_value": "58 hours"
          }
        },
        {
          "type": "comparison_row",
          "settings": {
            "feature_name": "Bass Technology",
            "ows1_value": "Not specified",
            "ows2_value": "Virtual Bass 2nd Gen",
            "owspro_value": "Virtual Bass 2nd Algorithm"
          }
        },
        {
          "type": "comparison_row",
          "settings": {
            "feature_name": "Weight (Single Earphone)",
            "ows1_value": "12.7g",
            "ows2_value": "12.7g",
            "owspro_value": "13.8g"
          }
        },
        {
          "type": "comparison_row",
          "settings": {
            "feature_name": "Waterproof Rating",
            "ows1_value": "IPX4",
            "ows2_value": "IPX4",
            "owspro_value": "IPX4"
          }
        }
      ]
    }
  ]
}
{% endschema %}
