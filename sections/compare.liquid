{%- comment -%}
  Generic Compare section for reuse across pages.
  - Block-based rows for flexible feature comparisons.
{%- endcomment -%}

{%- liquid
  assign fallback_section_id = 'compare-' | append: section.index
  assign section_id = section.settings.section_id | default: fallback_section_id
-%}

<section id="{{ section_id | escape }}" class="color-scheme color-{{ section.settings.color_scheme }} bg-background py-16 sm:py-20 lg:py-24">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="mx-auto max-w-2xl lg:text-center">
      <h2 class="text-3xl font-bold tracking-tight text-foreground sm:text-4xl font-heading">
        {{ section.settings.heading }}
      </h2>
      <p class="mt-6 text-lg leading-8 text-muted">
        {{ section.settings.subheading }}
      </p>
    </div>
    {%- liquid
      assign p1 = section.settings.product_col1
      assign p2 = section.settings.product_col2
      assign p3 = section.settings.product_col3
      assign show_cards = section.settings.show_product_cards
      assign has_col2 = false
      assign has_col3 = false
      if p2
        assign has_col2 = true
      else
        for block in section.blocks
          if block.settings.product_b_value != blank
            assign has_col2 = true
            break
          endif
        endfor
      endif
      if p3
        assign has_col3 = true
      else
        for block in section.blocks
          if block.settings.product_c_value != blank
            assign has_col3 = true
            break
          endif
        endfor
      endif
    -%}
    {%- if p1 == blank and product -%}
      {%- assign p1 = product -%}
    {%- endif -%}
    {%- liquid
      assign column_count = 1
      if has_col2
        assign column_count = column_count | plus: 1
      endif
      if has_col3
        assign column_count = column_count | plus: 1
      endif
      assign grid_template_style = 'grid-template-columns: repeat(' | append: column_count | append: ', minmax(0, 1fr));'
      assign col1_title = p1.title | default: section.settings.col1_fallback_label | default: 'Product A'
      assign col2_title = p2.title | default: section.settings.col2_fallback_label | default: 'Product B'
      assign col3_title = p3.title | default: section.settings.col3_fallback_label | default: 'Product C'
    -%}
    <div class="mt-16 sm:mt-12 lg:mt-18">
      <div class="rounded-[2.5rem]">
        <div class="-mx-2 overflow-x-auto sm:-mx-4">
          <div class="min-w-[720px] space-y-4 px-2 sm:px-4">
            <div class="grid gap-4" style="{{ grid_template_style }}">
              <div class="text-center">
                <div class="aspect-[4/3] rounded-xl overflow-hidden bg-background/50 flex items-center justify-center">
                  {%- if p1 and p1.featured_media -%}
                    <img src="{{ p1.featured_media | image_url: width: 640 }}" alt="{{ p1.featured_media.alt | default: col1_title | escape }}" class="h-full w-full object-cover" loading="lazy" decoding="async">
                  {%- else -%}
                    <div class="text-sm text-muted">No image</div>
                  {%- endif -%}
                </div>
                <h3 class="mt-4 font-heading text-lg font-semibold text-foreground">{{ col1_title }}</h3>
                {%- if p1 and p1.url -%}
                  <a href="{{ p1.url }}" class="btn btn-primary mt-3 inline-flex items-center justify-center">{{ section.settings.buy_now_label | default: 'Buy now' }}</a>
                {%- endif -%}
              </div>
              {%- if has_col2 -%}
                <div class="text-center">
                  <div class="aspect-[4/3] rounded-xl overflow-hidden bg-background/50 flex items-center justify-center">
                    {%- if p2 and p2.featured_media -%}
                      <img src="{{ p2.featured_media | image_url: width: 640 }}" alt="{{ p2.featured_media.alt | default: col2_title | escape }}" class="h-full w-full object-cover" loading="lazy" decoding="async">
                    {%- else -%}
                      <div class="text-sm text-muted">No image</div>
                    {%- endif -%}
                  </div>
                  <h3 class="mt-4 font-heading text-lg font-semibold text-foreground">{{ col2_title }}</h3>
                  {%- if p2 and p2.url -%}
                    <a href="{{ p2.url }}" class="btn btn-primary mt-3 inline-flex items-center justify-center">{{ section.settings.buy_now_label | default: 'Buy now' }}</a>
                  {%- endif -%}
                </div>
              {%- endif -%}
              {%- if has_col3 -%}
                <div class="text-center">
                  <div class="aspect-[4/3] rounded-xl overflow-hidden bg-background/50 flex items-center justify-center">
                    {%- if p3 and p3.featured_media -%}
                      <img src="{{ p3.featured_media | image_url: width: 640 }}" alt="{{ p3.featured_media.alt | default: col3_title | escape }}" class="h-full w-full object-cover" loading="lazy" decoding="async">
                    {%- else -%}
                      <div class="text-sm text-muted">No image</div>
                    {%- endif -%}
                  </div>
                  <h3 class="mt-4 font-heading text-lg font-semibold text-foreground">{{ col3_title }}</h3>
                  {%- if p3 and p3.url -%}
                    <a href="{{ p3.url }}" class="btn btn-primary mt-3 inline-flex items-center justify-center">{{ section.settings.buy_now_label | default: 'Buy now' }}</a>
                  {%- endif -%}
                </div>
              {%- endif -%}
            </div>
            {%- for block in section.blocks -%}
              {%- if forloop.first -%}
                <hr/>
              {%- endif -%}
              <div class="grid gap-4 rounded-3xl border-bottom border-border/60" style="{{ grid_template_style }}" {{ block.shopify_attributes }}>
                <div class="">
                  {%- if block.settings.feature_name != blank -%}
                    <p class="text-xs font-semibold uppercase tracking-wide text-muted">{{ block.settings.feature_name }}</p>
                  {%- endif -%}
                  <p class="mt-3 text-base md:text-lg font-semibold text-primary">{{ block.settings.product_a_value | default: '—' }}</p>
                </div>
                {%- if has_col2 -%}
                  <div class="rounded-2xl bg-background/70 text-center">
                    {%- if block.settings.feature_name != blank -%}
                      <p class="text-xs font-semibold uppercase opacity-0">{{ block.settings.feature_name }}</p>
                    {%- endif -%}
                    <p class="mt-3 text-foreground">{{ block.settings.product_b_value | default: '—' }}</p>
                  </div>
                {%- endif -%}
                {%- if has_col3 -%}
                  <div class="rounded-2xl bg-background/70 text-center">
                    {%- if block.settings.feature_name != blank -%}
                      <p class="text-xs font-semibold uppercase opacity-0">{{ block.settings.feature_name }}</p>
                    {%- endif -%}
                    <p class="mt-3 text-foreground">{{ block.settings.product_c_value | default: '—' }}</p>
                  </div>
                {%- endif -%}
              </div>
              <hr/>
            {%- endfor -%}
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Compare",
  "tag": "section",
  "class": "compare-section",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "scheme-1"
    },
    {
      "type": "text",
      "id": "section_id",
      "label": "Section ID",
      "info": "Used for anchor links. Defaults to compare-{index} when left blank."
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Compare Our Models"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Find the perfect Oladance for your lifestyle."
    },
    { "type": "header", "content": "Products" },
    {
      "type": "product",
      "id": "product_col1",
      "label": "Product A"
    },
    {
      "type": "product",
      "id": "product_col2",
      "label": "Product B"
    },
    {
      "type": "product",
      "id": "product_col3",
      "label": "Product C"
    },
    {
      "type": "checkbox",
      "id": "show_product_cards",
      "label": "Show product cards (image + Buy now)",
      "default": true
    },
    {
      "type": "text",
      "id": "buy_now_label",
      "label": "Buy now button label",
      "default": "Buy now"
    },
    { "type": "header", "content": "Fallback labels" },
    { "type": "text", "id": "col1_fallback_label", "label": "Product A label", "default": "Product A" },
    { "type": "text", "id": "col2_fallback_label", "label": "Product B label", "default": "Product B" },
    { "type": "text", "id": "col3_fallback_label", "label": "Product C label", "default": "Product C" }
  ],
  "blocks": [
    {
      "type": "comparison_row",
      "name": "Comparison Row",
      "settings": [
        {
          "type": "text",
          "id": "feature_name",
          "label": "Feature Name",
          "default": "Bluetooth Version"
        },
        {
          "type": "text",
          "id": "product_a_value",
          "label": "Product A Value",
          "default": "5.3"
        },
                {
          "type": "text",
          "id": "product_b_value",
          "label": "Product B Value",
          "default": "5.3"
        },
        {
          "type": "text",
          "id": "product_c_value",
          "label": "Product C Value",
          "default": "5.2"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Compare",
      "blocks": [
        {
          "type": "comparison_row",
          "settings": {
            "feature_name": "Driver Size",
            "product_c_value": "16.5mm (x2)",
            "product_b_value": "16.5mm (x2)",
            "product_a_value": "23mm*10mm"
          }
        },
        {
          "type": "comparison_row",
          "settings": {
            "feature_name": "Battery Life (Earphones)",
            "product_c_value": "16 hours",
            "product_b_value": "19 hours",
            "product_a_value": "16 hours"
          }
        },
        {
          "type": "comparison_row",
          "settings": {
            "feature_name": "Total Battery Life (with Case)",
            "product_c_value": "Not specified",
            "product_b_value": "Not specified",
            "product_a_value": "58 hours"
          }
        },
        {
          "type": "comparison_row",
          "settings": {
            "feature_name": "Bass Technology",
            "product_c_value": "Not specified",
            "product_b_value": "Virtual Bass 2nd Gen",
            "product_a_value": "Virtual Bass 2nd Algorithm"
          }
        },
        {
          "type": "comparison_row",
          "settings": {
            "feature_name": "Weight (Single Earphone)",
            "product_c_value": "12.7g",
            "product_b_value": "12.7g",
            "product_a_value": "13.8g"
          }
        },
        {
          "type": "comparison_row",
          "settings": {
            "feature_name": "Waterproof Rating",
            "product_c_value": "IPX4",
            "product_b_value": "IPX4",
            "product_a_value": "IPX4"
          }
        }
      ]
    }
  ]
}
{% endschema %}
