{% comment %}
  Main Blog Section
  Theme 2.0 - Sections Everywhere
  视觉规范: visual_spec.md
{% endcomment %}

{% assign section_color_scheme = section.settings.color_scheme | default: 'scheme-header' %}

<section class="color-scheme color-{{ section_color_scheme }} section-main-blog">
  <div class="w-full bg-background">
    <div class="container-custom min-h-screen py-8 sm:py-12">
  
    {%- comment -%} Blog Header - 基于 visual_spec.md Hero 规范 {%- endcomment -%}
  <div class="blog-header mt-8 mb-12 {% if section.settings.header_alignment == 'center' %}text-center{% endif %}">
      <h1 class="text-4xl sm:text-5xl font-extrabold tracking-tight leading-tight text-foreground mb-6">{{ blog.title }}</h1>
    {% if blog.description != blank %}
        <p class="text-lg sm:text-xl text-muted leading-relaxed max-w-3xl {% if section.settings.header_alignment == 'center' %}mx-auto{% endif %}">
        {{ blog.description }}
      </p>
    {% endif %}
  </div>
  
  {% paginate blog.articles by section.settings.articles_per_page %}
    <div class="blog-content">
      {%- comment -%} Filter by tag - 基于 visual_spec.md Category Chips 规范 {%- endcomment -%}
      {% if blog.all_tags.size > 0 and section.settings.show_tag_filter %}
        <div class="blog-tags-filter mb-10">
          <div class="flex flex-wrap gap-2">
            <a 
              href="{{ blog.url }}" 
              class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium transition-colors duration-200 {% if current_tags == blank %}bg-primary text-primary-foreground{% else %}bg-border/20 text-foreground hover:bg-border/40{% endif %}"
            >
              {{ 'blogs.general.view_all' | t }}
            </a>
            {% for tag in blog.all_tags %}
              <a 
                href="{{ blog.url }}/tagged/{{ tag | handle }}" 
                class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium transition-colors duration-200 {% if current_tags contains tag %}bg-primary text-primary-foreground{% else %}bg-border/20 text-foreground hover:bg-border/40{% endif %}"
              >
                {{ tag }}
              </a>
            {% endfor %}
          </div>
        </div>
      {% endif %}
      
      {%- comment -%} Articles Grid - gap-8 (32px) 突出卡片之间的层级 {%- endcomment -%}
      {% if blog.articles.size > 0 %}
        <div class="blog-articles grid grid-cols-1 md:grid-cols-2 lg:grid-cols-{{ section.settings.articles_per_row }} gap-8">
          {% for article in blog.articles %}
            {% render 'blog-card', 
              article: article,
              show_excerpt: section.settings.show_excerpt,
              show_author: section.settings.show_author,
              show_date: section.settings.show_date,
              show_tags: section.settings.show_tags,
              image_ratio: section.settings.image_ratio
            %}
          {% endfor %}
        </div>
        
        {%- comment -%} Pagination - 基于 visual_spec.md 按钮规范 {%- endcomment -%}
        {% if paginate.pages > 1 %}
          <nav class="pagination mt-16 flex justify-center items-center gap-3" role="navigation" aria-label="{{ 'general.pagination' | t }}">
            {% assign control_classes = 'inline-flex items-center justify-center w-10 h-10 rounded-full border border-border text-foreground hover:bg-primary/10 transition-all duration-200 shadow-sm hover:shadow' %}
            {% if paginate.previous %}
              <a 
                href="{{ paginate.previous.url }}" 
                class="{{ control_classes }}"
                aria-label="{{ 'general.pagination.previous' | t }}"
              >
                {% render 'icon', name: 'arrow-left', class: 'w-4 h-4' %}
              </a>
            {% else %}
              <span class="{{ control_classes }} opacity-40 cursor-not-allowed hover:bg-transparent hover:shadow-none" aria-hidden="true">
                {% render 'icon', name: 'arrow-left', class: 'w-4 h-4' %}
              </span>
            {% endif %}
            
            <span class="px-4 py-2 text-sm text-muted select-none">
              <span class="font-bold text-foreground">{{ paginate.current_page }}</span>
              <span class="mx-2 text-muted/70">/</span>
              <span>{{ paginate.pages }}</span>
            </span>
            
            {% if paginate.next %}
              <a 
                href="{{ paginate.next.url }}" 
                class="{{ control_classes }}"
                aria-label="{{ 'general.pagination.next' | t }}"
              >
                {% render 'icon', name: 'arrow-right', class: 'w-4 h-4' %}
              </a>
            {% else %}
              <span class="{{ control_classes }} opacity-40 cursor-not-allowed hover:bg-transparent hover:shadow-none" aria-hidden="true">
                {% render 'icon', name: 'arrow-right', class: 'w-4 h-4' %}
              </span>
            {% endif %}
          </nav>
        {% endif %}
      {% else %}
        {%- comment -%} No Articles State - 基于 visual_spec.md {%- endcomment -%}
        <div class="text-center py-20">
          {% render 'icon', name: 'document', class: 'w-24 h-24 mx-auto mb-6 text-muted/60' %}
          <h2 class="text-3xl font-extrabold text-foreground mb-4">{{ 'blogs.general.no_articles' | t }}</h2>
          {% if current_tags != blank %}
            <p class="text-lg text-muted mb-8 max-w-md mx-auto">No articles found with the selected tag.</p>
            <a href="{{ blog.url }}" class="btn btn-primary px-5 py-3 shadow font-medium">
              View all articles
            </a>
          {% endif %}
        </div>
      {% endif %}
      </div>
    {% endpaginate %}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Main Blog",
  "tag": "section",
  "class": "section-main-blog",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-header"
    },
    {
      "type": "range",
      "id": "articles_per_page",
      "min": 6,
      "max": 24,
      "step": 3,
      "default": 9,
      "label": "Articles per page"
    },
    {
      "type": "range",
      "id": "articles_per_row",
      "min": 2,
      "max": 4,
      "step": 1,
      "default": 3,
      "label": "Articles per row (desktop)"
    },
    {
      "type": "select",
      "id": "header_alignment",
      "label": "Header alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        }
      ],
      "default": "center"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "label": "Image ratio",
      "options": [
        {
          "value": "1:1",
          "label": "Square (1:1)"
        },
        {
          "value": "4:3",
          "label": "Landscape (4:3)"
        },
        {
          "value": "16:9",
          "label": "Widescreen (16:9)"
        }
      ],
      "default": "16:9"
    },
    {
      "type": "checkbox",
      "id": "show_tag_filter",
      "label": "Show tag filter",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_excerpt",
      "label": "Show article excerpt",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_author",
      "label": "Show article author",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_date",
      "label": "Show publish date",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_tags",
      "label": "Show article tags",
      "default": false
    }
  ]
}
{% endschema %}
