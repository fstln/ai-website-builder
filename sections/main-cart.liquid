{% comment %}
  Main Cart Section
  Theme 2.0 - Sections Everywhere
  Updated with modern DTC visual design
{% endcomment %}

{% assign section_color_scheme = section.settings.color_scheme | default: 'scheme-1' %}

<cart-items-component 
  class="color-scheme color-{{ section_color_scheme }} cart-items-wrapper block bg-background text-foreground min-h-screen" 
  data-section-id="{{ section.id }}"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
    {% if cart.item_count > 0 %}
      {%- comment -%} Cart Header {%- endcomment -%}
      <div class="mb-10">
        <h1 class="text-4xl sm:text-5xl font-extrabold tracking-tight text-foreground">{{ 'general.cart.title' | t }}</h1>
      </div>
      
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        {%- comment -%} Cart Items - Left Column {%- endcomment -%}
        <div class="lg:col-span-2">
          {%- comment -%} Error container {%- endcomment -%}
          <div data-cart-error class="hidden bg-error/10 border border-error/30 text-error px-4 py-3 rounded-lg mb-4 text-sm"></div>
          
              {%- comment -%} Cart Items List {%- endcomment -%}
              <div class="cart-items space-y-5">
                {% for item in cart.items %}
                  {%- assign line_index = forloop.index0 -%}
                  <div
                    class="cart-item grid grid-cols-[auto_1fr_auto] items-start gap-4 p-5 bg-background rounded-2xl"
                    data-cart-item="{{ item.key }}"
                    data-item-key="{{ item.key }}"
                    ref="cartItemRows[]"
                  >
                {%- comment -%} Product Image {%- endcomment -%}
                {% if item.image %}
                  <a href="{{ item.url }}" class="flex-shrink-0 group">
                    <img 
                      src="{{ item.image | image_url: width: 160 }}" 
                      alt="{{ item.title }}" 
                      class="w-20 h-20 sm:w-28 sm:h-28 object-cover rounded-2xl group-hover:opacity-90 transition-opacity"
                      loading="lazy"
                    >
                  </a>
                {% endif %}
                
                {%- comment -%} Product Info {%- endcomment -%}
                <div class="flex flex-col gap-3 min-w-0">
                  <div class="space-y-2">
                    <h3 class="font-semibold text-lg sm:text-xl text-foreground">
                      <a href="{{ item.url }}" class="hover:text-primary transition-colors break-words">
                        {{ item.product.title }}
                      </a>
                    </h3>
                    
                    {%- comment -%} Variant Title {%- endcomment -%}
                    {% unless item.variant.title contains 'Default' %}
                      <p class="text-sm text-muted">
                        {{ item.variant.title }}
                      </p>
                    {% endunless %}
                    
                    {%- comment -%} Line Item Properties {%- endcomment -%}
                    {% if item.properties.size > 0 %}
                      <div class="item-properties text-sm text-muted space-y-1">
                        {% for property in item.properties %}
                          {% unless property.first contains '_' %}
                            <div>
                              <span class="font-medium text-foreground">{{ property.first }}:</span>
                              {{ property.last }}
                            </div>
                          {% endunless %}
                        {% endfor %}
                      </div>
                    {% endif %}
                  </div>
                  
                  {%- comment -%} Quantity & Remove {%- endcomment -%}
                  <div class="flex items-center gap-4 flex-wrap mt-2">
                    <div class="quantity-wrapper" ref="quantitySelectors[]">
                      {% render 'quantity-input',
                        id: 'Quantity-' | append: item.key,
                        name: 'updates[' | append: item.key | append: ']',
                        value: item.quantity,
                        min: 0,
                        label: item.product.title,
                        line_index: line_index,
                        variant_id: item.variant.id,
                        class: 'w-auto'
                      %}
                    </div>
                    <button 
                      type="button" 
                      class="text-sm font-medium text-muted hover:text-error transition-colors"
                      data-cart-remove="{{ item.key }}"
                      data-item-name="{{ item.product.title }}"
                      aria-label="{{ 'general.cart.remove' | t }}: {{ item.product.title }}"
                    >
                      {{ 'general.cart.remove' | t }}
                    </button>
                  </div>
                  
                  {%- comment -%} Discounts {%- endcomment -%}
                  {% if item.line_level_discount_allocations.size > 0 %}
                    <div class="item-discounts space-y-1 mt-2">
                      {% for discount in item.line_level_discount_allocations %}
                        <div class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-success/10 text-success text-xs font-medium">
                          {% render 'icon', name: 'tag', class: 'w-3.5 h-3.5' %}
                          {{ discount.discount_application.title }} (-{{ discount.amount | money }})
                        </div>
                      {% endfor %}
                    </div>
                  {% endif %}
                </div>
                
                {%- comment -%} Price Display {%- endcomment -%}
                <div class="item-price-wrapper text-right space-y-1 min-w-[5rem]">
                  <div class="text-sm text-muted">
                    {% if item.original_price > item.final_price %}
                      <span class="line-through">{{ item.original_price | money }}</span>
                      <span class="text-error font-medium ml-1">{{ item.final_price | money }}</span>
                    {% else %}
                      {{ item.final_price | money }}
                    {% endif %}
                    <span class="text-muted mx-1">Ã—</span>
                    <span>{{ item.quantity }}</span>
                  </div>
                  
                  {% if item.original_line_price > item.final_line_price %}
                    <div class="flex items-center gap-2 justify-end">
                      <span class="text-error font-bold text-xl" data-item-price>
                        {{ item.final_line_price | money }}
                      </span>
                      <span class="text-sm text-muted/60 line-through">
                        {{ item.original_line_price | money }}
                      </span>
                    </div>
                  {% else %}
                    <div class="font-bold text-xl text-foreground" data-item-price>
                      {{ item.final_line_price | money }}
                    </div>
                  {% endif %}
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
        
        {%- comment -%} Cart Summary - Right Column via block {%- endcomment -%}
        <div class="lg:col-span-1">
          {% for block in section.blocks %}
            {% case block.type %}
              {% when 'cart_subtotal' %}
                <div class="color-scheme color-{{ block.settings.color_scheme | default: 'scheme-1' }} cart-summary bg-surface p-6 sm:p-8 rounded-2xl sticky top-4" {{ block.shopify_attributes }}>
                  <h2 class="text-2xl font-bold text-foreground mb-6">{{ 'general.cart.subtotal' | t }}</h2>
                  <div class="flex justify-between items-baseline pb-6 mb-6">
                    <span class="text-lg font-medium text-muted">{{ 'general.cart.subtotal' | t }}</span>
                    <span class="text-3xl font-bold text-foreground" data-cart-subtotal>{{ cart.total_price | money }}</span>
                  </div>
                  {% if cart.cart_level_discount_applications.size > 0 %}
                    <div class="cart-discounts mb-6 pb-6 space-y-2">
                      {% for discount in cart.cart_level_discount_applications %}
                        <div class="flex justify-between items-center text-sm">
                          <span class="text-success font-medium">{{ discount.title }}</span>
                          <span class="text-success font-semibold">-{{ discount.total_allocated_amount | money }}</span>
                        </div>
                      {% endfor %}
                    </div>
                  {% endif %}
                  <p class="text-sm text-muted mb-6 text-center">
                    {{ 'general.cart.taxes_and_shipping_at_checkout' | t }}
                  </p>
                  <a href="/checkout" class="btn btn-primary block text-center w-full text-base font-semibold mb-3">
                    {{ 'general.cart.checkout' | t }}
                  </a>
                  <a href="{{ routes.all_products_collection_url }}" class="btn btn-outline-primary block w-full text-center text-base font-semibold">
                    {{ 'general.continue_shopping' | t }}
                  </a>
                </div>
            {% endcase %}
          {% endfor %}
        </div>
      </div>
    {% else %}
      {%- comment -%} Empty Cart State {%- endcomment -%}
      <div class="empty-cart text-center py-16 sm:py-24">
        <div class="max-w-md mx-auto bg-background rounded-2xl p-10">
          <div class="w-32 h-32 mx-auto mb-8 rounded-full bg-border/20 flex items-center justify-center">
            {% render 'icon', name: 'bag', class: 'w-16 h-16 text-muted/60' %}
          </div>
          <h2 class="text-3xl font-bold text-foreground mb-4">{{ 'general.cart.empty' | t }}</h2>
          <a 
            href="{{ routes.all_products_collection_url }}" 
            class="btn btn-primary px-8 py-4 text-base font-semibold"
          >
            {{ 'general.continue_shopping' | t }}
          </a>
        </div>
      </div>
    {% endif %}
  </div>
</cart-items-component>

{% schema %}
{
  "name": "Main Cart",
  "tag": "section",
  "class": "section-main-cart",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    }
  ],
  "blocks": [
    {
      "type": "cart_subtotal",
      "name": "Cart subtotal",
      "limit": 1,
      "settings": [
        {
          "type": "color_scheme",
          "id": "color_scheme",
          "label": "Color scheme",
          "default": "scheme-1"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Main Cart",
      "blocks": [
        { "type": "cart_subtotal" }
      ]
    }
  ]
}
{% endschema %}
