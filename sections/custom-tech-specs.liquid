{%- comment -%}
  Section: Tech Specs
  Renders a two-column layout with a configurable accordion and a "what's in the box" list.
  - Replaces Alpine.js with a vanilla JS Web Component for the accordion.
  - All content is editable through the section schema.
{%- endcomment -%}

{%- liquid
  assign section_dom_id = 'section-' | append: section.id
  assign accordion_items = section.blocks | where: 'type', 'accordion_item'
  assign box_items = section.blocks | where: 'type', 'box_item'
-%}

<div id="{{ section_dom_id }}" class="isolate" data-section-id="{{ section.id }}">
  <section class="py-16 lg:py-24 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 lg:grid-cols-5 gap-12 lg:gap-16">

        <!-- Left Side: Accordion -->
        <div class="lg:col-span-3">
          <div class="mb-10">
            {%- if section.settings.heading != blank -%}
              <h2 class="text-3xl sm:text-4xl font-bold text-gray-900 mb-4">
                {{ section.settings.heading | escape }}
              </h2>
            {%- endif -%}
            {%- if section.settings.subheading != blank -%}
              <div class="text-lg text-gray-600 prose">
                {{ section.settings.subheading }}
              </div>
            {%- endif -%}
          </div>

          {%- if accordion_items.size > 0 -%}
            <accordion-control class="space-y-4">
              {%- for block in accordion_items -%}
                <div class="bg-gray-50 rounded-2xl border border-gray-200" {{ block.shopify_attributes }}>
                  <button
                    class="accordion-trigger w-full flex items-center justify-between p-6 text-left"
                    aria-expanded="false"
                    aria-controls="accordion-content-{{ forloop.index }}-{{ section.id }}"
                  >
                    <span class="text-lg font-semibold text-gray-800">{{ block.settings.title | escape }}</span>
                    <i class="ri-arrow-down-s-line text-2xl transition-transform accordion-icon"></i>
                  </button>
                  <div
                    id="accordion-content-{{ forloop.index }}-{{ section.id }}"
                    class="accordion-content px-6 pb-6 text-gray-600"
                  >
                    <div class="prose max-w-none">
                      {{ block.settings.content }}
                    </div>
                  </div>
                </div>
              {%- endfor -%}
            </accordion-control>
          {%- endif -%}
        </div>

        <!-- Right Side: What's in the Box -->
        <div class="lg:col-span-2">
          {%- if box_items.size > 0 -%}
            <div class="bg-gray-50 rounded-3xl p-8 lg:p-10 border border-gray-200 h-full">
              {%- if section.settings.box_heading != blank -%}
                <h3 class="text-2xl font-bold text-gray-900 mb-8">
                  {{ section.settings.box_heading | escape }}
                </h3>
              {%- endif -%}
              <ul class="space-y-6">
                {%- for block in box_items -%}
                  <li class="flex items-center gap-6" {{ block.shopify_attributes }}>
                    <div class="bg-white rounded-xl p-3 border border-gray-200">
                      <i class="{{ block.settings.icon | default: 'ri-checkbox-blank-circle-line' }} text-3xl text-blue-600"></i>
                    </div>
                    <span class="font-medium text-gray-700">{{ block.settings.text | escape }}</span>
                  </li>
                {%- endfor -%}
              </ul>
            </div>
          {%- endif -%}
        </div>

      </div>
    </div>
  </section>
</div>

<style>
  #{{ section_dom_id }} .accordion-content {
    display: grid;
    grid-template-rows: 0fr;
    transition: grid-template-rows 0.3s ease-in-out;
  }
  #{{ section_dom_id }} .accordion-content > div {
    overflow: hidden;
  }
  #{{ section_dom_id }} .accordion-trigger[aria-expanded="true"] + .accordion-content {
    grid-template-rows: 1fr;
  }
  #{{ section_dom_id }} .accordion-trigger[aria-expanded="true"] .accordion-icon {
    transform: rotate(180deg);
  }
</style>

<script>
  if (!customElements.get('accordion-control')) {
    customElements.define('accordion-control', class AccordionControl extends HTMLElement {
      constructor() {
        super();
        this.triggers = this.querySelectorAll('.accordion-trigger');
        this.triggers.forEach(trigger => trigger.addEventListener('click', this.toggle.bind(this)));
      }

      toggle(event) {
        const trigger = event.currentTarget;
        const isExpanded = trigger.getAttribute('aria-expanded') === 'true';

        // Close all other accordions in this group
        this.triggers.forEach(t => {
          if (t !== trigger) {
            t.setAttribute('aria-expanded', 'false');
          }
        });

        // Toggle the clicked accordion
        trigger.setAttribute('aria-expanded', !isExpanded);
      }
    });
  }
</script>

{% schema %}
{
  "name": "C: Tech Specs",
  "tag": "section",
  "class": "section-tech-specs",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Under the Hood"
    },
    {
      "type": "richtext",
      "id": "subheading",
      "label": "Subheading",
      "default": "<p>Every detail of the OWS 2 is engineered for an exceptional open-ear listening experience.</p>"
    },
    {
      "type": "text",
      "id": "box_heading",
      "label": "Box Heading",
      "default": "What's in the Box"
    }
  ],
  "blocks": [
    {
      "type": "accordion_item",
      "name": "Accordion Item",
      "limit": 6,
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Accordion Title"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content",
          "default": "<p>Use a list or paragraph to detail the specifications.</p>"
        }
      ]
    },
    {
      "type": "box_item",
      "name": "Box Item",
      "limit": 8,
      "settings": [
        {
          "type": "text",
          "id": "icon",
          "label": "Remix Icon Class",
          "info": "E.g., 'ri-headphone-line'. Find more at remixicon.com",
          "default": "ri-headphone-line"
        },
        {
          "type": "text",
          "id": "text",
          "label": "Item Text",
          "default": "Item in the box"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Tech Specs",
      "blocks": [
        {
          "type": "accordion_item",
          "settings": {
            "title": "Audio",
            "content": "<ul class='list-disc list-inside space-y-2'><li><strong>Dynamic Drivers:</strong> Two 16.5mm Drivers</li><li><strong>Audio Coding:</strong> SBC</li><li><strong>Bass Effect:</strong> Virtual Bass 2nd Generation</li><li><strong>Noise Cancellation:</strong> Environmental Noise Cancellation (ENC)</li></ul>"
          }
        },
        {
          "type": "accordion_item",
          "settings": {
            "title": "Connectivity & Battery",
            "content": "<ul class='list-disc list-inside space-y-2'><li><strong>Bluetooth Version:</strong> 5.3</li><li><strong>Multipoint Connection:</strong> Supported</li><li><strong>Battery Life:</strong> Up to 19 hours</li><li><strong>Charging Time:</strong> 1.5-2 hours via Type-C</li></ul>"
          }
        },
        {
          "type": "accordion_item",
          "settings": {
            "title": "Design & Durability",
            "content": "<ul class='list-disc list-inside space-y-2'><li><strong>Type:</strong> Open Ear</li><li><strong>Materials:</strong> Medical-grade Liquid Silicone Rubber</li><li><strong>Net Weight:</strong> 12.7g (Single Ear)</li><li><strong>Waterproofing:</strong> IPX4</li></ul>"
          }
        },
        {
          "type": "box_item",
          "settings": {
            "icon": "ri-headphone-line",
            "text": "Oladance OWS 2 Earbuds"
          }
        },
        {
          "type": "box_item",
          "settings": {
            "icon": "ri-hard-drive-2-line",
            "text": "Carry Case"
          }
        },
        {
          "type": "box_item",
          "settings": {
            "icon": "ri-usb-line",
            "text": "Type-C Charging Cable"
          }
        },
        {
          "type": "box_item",
          "settings": {
            "icon": "ri-book-read-line",
            "text": "User Manual"
          }
        },
        {
          "type": "box_item",
          "settings": {
            "icon": "ri-equalizer-line",
            "text": "Earbuds Supporter"
          }
        }
      ]
    }
  ]
}
{% endschema %}
