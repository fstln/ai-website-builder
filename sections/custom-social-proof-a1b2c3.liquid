{%- liquid
  assign section_dom_id = "social-proof-" | append: section.id
-%}

<section
  id="{{ section_dom_id }}"
  class="relative isolate px-6 py-16 lg:py-24 color-scheme color-{{ section.settings.color_scheme | default: 'scheme-1' }} bg-background"
>
  <div class="mx-auto max-w-7xl">
    {%- if section.settings.title != blank or section.settings.subtitle != blank -%}
      <div class="text-center mb-16">
        {%- if section.settings.title != blank -%}
          <h2 class="text-4xl md:text-5xl font-bold tracking-tight text-foreground mb-4">
            {{ section.settings.title }}
          </h2>
        {%- endif -%}
        {%- if section.settings.subtitle != blank -%}
          <p class="text-lg md:text-xl text-muted max-w-2xl mx-auto">
            {{ section.settings.subtitle }}
          </p>
        {%- endif -%}
      </div>
    {%- endif -%}

    {%- assign media_reviews = section.blocks | where: "type", "media_review" -%}
    {%- if media_reviews.size > 0 -%}
      <div class="mb-16">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
          {%- for block in media_reviews -%}
            <div
              class="bg-surface rounded-2xl p-8 shadow-sm hover:shadow-lg transition-all duration-300 border border-border group"
              {{ block.shopify_attributes }}
            >
              <div class="flex items-center mb-6">
                {%- if block.settings.logo != blank -%}
                  <img
                    src="{{ block.settings.logo | image_url: width: 240 }}"
                    alt="{{ block.settings.logo.alt | escape }}"
                    class="h-8 object-contain grayscale group-hover:grayscale-0 transition-all duration-300"
                    width="120"
                    height="40"
                    loading="lazy"
                  >
                {%- else -%}
                  {{ 'image' | placeholder_svg_tag: 'h-8 w-auto text-muted' }}
                {%- endif -%}
              </div>
              {%- if block.settings.quote != blank -%}
                <blockquote class="text-foreground text-lg leading-relaxed mb-4">
                  {{ block.settings.quote }}
                </blockquote>
              {%- endif -%}
              {%- if block.settings.author != blank -%}
                <cite class="text-sm text-muted not-italic">â€” {{ block.settings.author }}</cite>
              {%- endif -%}
            </div>
          {%- endfor -%}
        </div>
      </div>
    {%- endif -%}

    {%- assign user_reviews = section.blocks | where: "type", "user_review" -%}
    {%- if user_reviews.size > 0 -%}
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {%- for block in user_reviews -%}
          <div
            class="bg-surface rounded-2xl p-6 shadow-sm hover:shadow-md transition-all duration-300 border border-border"
            {{ block.shopify_attributes }}
          >
            <div class="flex items-center mb-4">
              {%- if block.settings.avatar != blank -%}
                <img
                  src="{{ block.settings.avatar | image_url: width: 96 }}"
                  alt="{{ block.settings.avatar.alt | escape }}"
                  class="w-12 h-12 rounded-full mr-4"
                  width="48"
                  height="48"
                  loading="lazy"
                >
              {%- else -%}
                <div class="w-12 h-12 rounded-full mr-4 bg-surface-muted flex items-center justify-center">
                  <svg class="w-6 h-6 text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                </div>
              {%- endif -%}
              <div class="flex-1">
                {%- if block.settings.name != blank -%}
                  <h4 class="font-semibold text-foreground">{{ block.settings.name }}</h4>
                {%- endif -%}
                <div class="flex items-center gap-1 mt-1">
                  {%- for i in (1..block.settings.rating) -%}
                    <svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                  {%- endfor -%}
                </div>
              </div>
            </div>
            {%- if block.settings.review_text != blank -%}
              <p class="text-muted leading-relaxed">
                {{ block.settings.review_text }}
              </p>
            {%- endif -%}
          </div>
        {%- endfor -%}
      </div>
    {%- endif -%}
  </div>
</section>

{% schema %}
{
  "name": "C: Social Proof",
  "tag": "section",
  "class": "custom-social-proof",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "scheme-1"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Trusted by Thousands"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Subheading",
      "default": "Hear what our community and the press have to say."
    }
  ],
  "blocks": [
    {
      "type": "media_review",
      "name": "Media Review",
      "limit": 3,
      "settings": [
        {
          "type": "image_picker",
          "id": "logo",
          "label": "Media Logo"
        },
        {
          "type": "richtext",
          "id": "quote",
          "label": "Quote",
          "default": "<p>A game-changer in open-ear audio technology. The OWS Pro delivers exceptional sound without compromising situational awareness.</p>"
        },
        {
          "type": "text",
          "id": "author",
          "label": "Author",
          "default": "Tech Editor, TechCrunch"
        }
      ]
    },
    {
      "type": "user_review",
      "name": "User Review",
      "limit": 6,
      "settings": [
        {
          "type": "image_picker",
          "id": "avatar",
          "label": "Avatar"
        },
        {
          "type": "text",
          "id": "name",
          "label": "Name",
          "default": "Sarah M."
        },
        {
          "type": "range",
          "id": "rating",
          "min": 1,
          "max": 5,
          "step": 1,
          "unit": "s",
          "label": "Rating",
          "default": 5
        },
        {
          "type": "textarea",
          "id": "review_text",
          "label": "Review Text",
          "default": "Best earbuds for running! I can finally enjoy my music while staying aware of traffic. The bass is surprisingly powerful for open-ear design."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "C: Social Proof",
      "blocks": [
        { "type": "media_review" },
        { "type": "media_review" },
        { "type": "media_review" },
        { "type": "user_review" },
        { "type": "user_review" },
        { "type": "user_review" }
      ]
    }
  ]
}
{% endschema %}
