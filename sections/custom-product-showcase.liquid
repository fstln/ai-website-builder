{% comment %} /sections/custom-product-showcase.liquid {% endcomment %}
{%- liquid
  assign section_dom_id = 'product-showcase-' | append: section.id
-%}

<section
  id="product-showcase"
  class="py-24"
  style="--section-bg: {{ section.settings.background_color }};"
>
  <div class="bg-[var(--section-bg)]">
    <div class="container mx-auto px-6 max-w-[1200px]">
      {%- if section.settings.heading != blank -%}
        <div class="text-center mb-12">
          <h2 class="font-display font-bold text-3xl md:text-4xl text-gray-900">{{ section.settings.heading }}</h2>
        </div>
      {%- endif -%}

      {%- if section.blocks.size > 0 -%}
        <div class="flex justify-center mb-12">
          <div
            id="{{ section_dom_id }}-tabs"
            class="inline-flex bg-white p-1.5 rounded-full shadow-sm border border-gray-200"
            role="tablist"
          >
            {%- for block in section.blocks -%}
              <button
                class="tab-btn px-6 py-2.5 rounded-full text-sm font-semibold {% if forloop.first %}bg-black text-white shadow-md{% else %}text-gray-500{% endif %}"
                data-target="{{ section_dom_id }}-{{ block.id }}"
                role="tab"
                aria-selected="{% if forloop.first %}true{% else %}false{% endif %}"
                aria-controls="{{ section_dom_id }}-{{ block.id }}"
              >
                {{ block.settings.tab_label }}
              </button>
            {%- endfor -%}
          </div>
        </div>

        <div class="relative min-h-[500px]">
          {%- for block in section.blocks -%}
            <div
              id="{{ section_dom_id }}-{{ block.id }}"
              class="tab-content grid grid-cols-1 lg:grid-cols-2 gap-12 items-center {% unless forloop.first %}hidden{% endunless %}"
              role="tabpanel"
              {{ block.shopify_attributes }}
            >
              <div class="relative group rounded-3xl overflow-hidden bg-white">
                {%- if block.settings.image != blank -%}
                  <img
                    src="{{ block.settings.image | image_url: width: 1600 }}"
                    alt="{{ block.settings.image.alt | escape }}"
                    width="800"
                    height="600"
                    loading="lazy"
                    class="w-full h-auto"
                  >
                {%- else -%}
                  {{ 'image' | placeholder_svg_tag: 'placeholder-svg w-full h-auto' }}
                {%- endif -%}
              </div>
              <div>
                {%- if block.settings.product_title != blank -%}
                  <h3 class="font-display font-bold text-2xl text-gray-900 mb-3">{{ block.settings.product_title }}</h3>
                {%- endif -%}
                {%- if block.settings.product_description != blank -%}
                  <div class="font-sans text-gray-600 mb-6">{{ block.settings.product_description }}</div>
                {%- endif -%}
                {%- if block.settings.button_label != blank and block.settings.product_link != blank -%}
                  <a href="{{ block.settings.product_link.url }}" class="font-semibold text-brand-blue hover:underline">
                    {{ block.settings.button_label }}
                  </a>
                {%- endif -%}
              </div>
            </div>
          {%- endfor -%}
        </div>
      {%- endif -%}
    </div>
  </div>
</section>

<script type="module">
  document.addEventListener('DOMContentLoaded', () => {
    const tabContainer = document.getElementById('{{ section_dom_id }}-tabs');
    if (!tabContainer) return;

    const tabs = tabContainer.querySelectorAll('[role="tab"]');
    const panels = tabContainer.closest('section').querySelectorAll('[role="tabpanel"]');

    tabs.forEach(tab => {
      tab.addEventListener('click', (event) => {
        const targetPanelId = event.currentTarget.getAttribute('data-target');

        tabs.forEach(t => {
          t.setAttribute('aria-selected', 'false');
          t.classList.remove('bg-black', 'text-white', 'shadow-md');
          t.classList.add('text-gray-500');
        });

        panels.forEach(p => {
          p.classList.add('hidden');
        });

        event.currentTarget.setAttribute('aria-selected', 'true');
        event.currentTarget.classList.add('bg-black', 'text-white', 'shadow-md');
        event.currentTarget.classList.remove('text-gray-500');

        const targetPanel = document.getElementById(targetPanelId);
        if (targetPanel) {
          targetPanel.classList.remove('hidden');
        }
      });
    });
  });
</script>

{% schema %}
{
  "name": "C: Product Showcase",
  "tag": "section",
  "class": "custom-product-showcase-section",
  "settings": [
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#FAFAFA"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Find Your Perfect Sound"
    }
  ],
  "blocks": [
    {
      "type": "product_tab",
      "name": "Product Tab",
      "limit": 3,
      "settings": [
        {
          "type": "text",
          "id": "tab_label",
          "label": "Tab Label",
          "default": "OWS Pro"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Product Image"
        },
        {
          "type": "text",
          "id": "product_title",
          "label": "Product Title",
          "default": "OWS Pro"
        },
        {
          "type": "richtext",
          "id": "product_description",
          "label": "Product Description",
          "default": "<p>HEAR THE BASS, NOT THE NOISE</p>"
        },
        {
          "type": "text",
          "id": "button_label",
          "label": "Button Label",
          "default": "Shop Now"
        },
        {
          "type": "product",
          "id": "product_link",
          "label": "Product Link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "C: Product Showcase",
      "blocks": [
        {
          "type": "product_tab"
        },
        {
          "type": "product_tab",
          "settings": {
            "tab_label": "OWS 2",
            "product_title": "OWS 2",
            "product_description": "<p>HEAR THE DIFFERENCE. FEEL THE DEPTH.</p>"
          }
        },
        {
          "type": "product_tab",
          "settings": {
            "tab_label": "OWS 1",
            "product_title": "OWS 1",
            "product_description": "<p>True Open-Ear Design, 16h Battery</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}
