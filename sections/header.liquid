{% comment %}
  Header Section - Modern DTC Design
  Sticky header with show-on-scroll-up behavior
{% endcomment %}

{% liquid
  assign menu_linklist = section.settings.main_menu | default: 'main-menu'
  assign nav_position = section.settings.nav_position | default: 'left'
  assign nav_position_class = 'header__nav--' | append: nav_position
%}

<header 
  class="header header--sticky header--blur" 
  data-header
>
  <div class="header__container container-custom">
    <div class="header__inner">
      
      {%comment%} Mobile Menu Toggle {%endcomment%}
      <button 
        type="button"
        class="header__menu-toggle" 
        data-mobile-menu-toggle
        aria-expanded="false"
        aria-label="{{ 'header.menu' | t }}"
        aria-controls="mobile-nav"
      >
        <span class="header__menu-icon">
          <span class="header__menu-icon-line"></span>
          <span class="header__menu-icon-line"></span>
          <span class="header__menu-icon-line"></span>
        </span>
      </button>

      {%comment%} Logo {%endcomment%}
      <div class="header__logo">
        <a href="{{ routes.root_url }}" class="header__logo-link">
          {% if section.settings.logo %}
            {{
              section.settings.logo
              | image_url: width: 600
              | image_tag:
                class: 'header__logo-image w-auto',
                alt: shop.name,
                width: '80px',
                height: 'auto',
                loading: 'eager'
            }}
          {% else %}
            <span class="header__logo-text">{{ shop.name }}</span>
          {% endif %}
        </a>
      </div>

      {%comment%} Desktop Navigation {%endcomment%}
      <nav class="header__nav {{ nav_position_class }}" aria-label="{{ 'header.menu' | t }}">
        {% if linklists[menu_linklist].links.size > 0 %}
          <ul class="header__nav-list">
            {% for link in linklists[menu_linklist].links %}
              <li class="header__nav-item">
                <a 
                  href="{{ link.url }}" 
                  class="header__nav-link"
                >
                  {{ link.title }}
                </a>
              </li>
            {% endfor %}
          </ul>
        {% endif %}
      </nav>

      {%comment%} Header Actions {%endcomment%}
      <div class="header__actions">
        {%comment%} Cart {%endcomment%}
        <a 
          href="{{ routes.cart_url }}" 
          class="header__action-link header__cart-link"
          aria-label="{{ 'header.cart' | t }} ({{ cart.item_count }} {{ 'header.items' | t }})"
        >
          <svg class="header__icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="9" cy="21" r="1"></circle>
            <circle cx="20" cy="21" r="1"></circle>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
          </svg>
          {% if cart.item_count > 0 %}
            <span class="header__cart-count" data-cart-count>{{ cart.item_count }}</span>
          {% else %}
            <span class="header__cart-count" data-cart-count hidden>0</span>
          {% endif %}
        </a>

        {%comment%} Account {%endcomment%}
        {% if shop.customer_accounts_enabled %}
          <a 
            href="{% if customer %}{{ routes.account_url }}{% else %}{{ routes.account_login_url }}{% endif %}" 
            class="header__action-link header__account-link"
            aria-label="{% if customer %}{{ 'header.account' | t }}{% else %}{{ 'header.log_in' | t }}{% endif %}"
          >
            <svg class="header__icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          </a>
        {% endif %}
      </div>
    </div>
  </div>

  {%comment%} Mobile Navigation Drawer {%endcomment%}
  <div 
    id="mobile-nav"
    class="header__mobile-drawer" 
    data-mobile-drawer
    aria-hidden="true"
  >
    <div class="header__mobile-backdrop" data-mobile-backdrop></div>
    <div class="header__mobile-panel">
      <div class="header__mobile-header">
        <div class="header__mobile-logo">
          {% if section.settings.logo %}
            {{
              section.settings.logo
              | image_url: width: 300
              | image_tag:
                alt: shop.name,
                width: 120,
                height: 'auto'
            }}
          {% else %}
            <span class="header__mobile-logo-text">{{ shop.name }}</span>
          {% endif %}
        </div>
        <button 
          type="button"
          class="header__mobile-close" 
          data-mobile-close
          aria-label="{{ 'header.close_menu' | t }}"
        >
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      
      <nav class="header__mobile-nav" aria-label="{{ 'header.menu' | t }}">
        {% if linklists[menu_linklist].links.size > 0 %}
          <ul class="header__mobile-nav-list">
            {% for link in linklists[menu_linklist].links %}
              <li>
                <a 
                  href="{{ link.url }}" 
                  class="header__mobile-nav-link"
                  {% if link.active %}aria-current="page"{% endif %}
                >
                  {{ link.title }}
                </a>
              </li>
            {% endfor %}
            
            {%comment%} Account Link in Mobile {%endcomment%}
            {% if shop.customer_accounts_enabled %}
              <li class="header__mobile-divider">
                <a 
                  href="{% if customer %}{{ routes.account_url }}{% else %}{{ routes.account_login_url }}{% endif %}" 
                  class="header__mobile-nav-link header__mobile-nav-link--highlighted"
                >
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                  <span>
                    {% if customer %}
                      {{ customer.first_name | default: 'Account' }}
                    {% else %}
                      {{ 'header.log_in' | t }}
                    {% endif %}
                  </span>
                </a>
              </li>
            {% endif %}
          </ul>
        {% endif %}
      </nav>
    </div>
  </div>
</header>

{% stylesheet %}
/* Header Base Styles */
.header {
  position: relative;
  width: 100%;
  z-index: 100;
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
              box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Sticky Header with Blur Effect */
.header--sticky {
  position: sticky;
  top: 0;
}

.header--blur {
  background-color: rgba(255, 255, 255, 0.8);
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
}

/* Header Container */
.header__container {
  border-bottom: 1px solid rgba(0, 0, 0, 0.05);
  transition: border-color 0.3s ease;
}

.header--scrolled .header__container {
  border-bottom-color: rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
}

.header__inner {
  position: relative;
  display: flex;
  align-items: center;
  gap: var(--spacing-8);
  padding: var(--spacing-4) 0;
  min-height: 64px;
}

/* Logo */
.header__logo {
  display: flex;
  align-items: center;
}

.header__logo-link {
  display: flex;
  align-items: center;
  text-decoration: none;
  transition: opacity 0.2s ease;
}

.header__logo-link:hover {
  opacity: 0.8;
}

.header__logo-image {
  display: block;
  max-width: 100%;
  height: auto;
}

.header__logo-text {
  font-size: var(--text-size-lg);
  font-weight: 600;
  color: var(--color-text);
  letter-spacing: -0.02em;
}

/* Desktop Navigation */
.header__nav {
  display: none;
}

/* Navigation Position: Center */
.header__nav--center {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
}

.header__nav-list {
  display: flex;
  gap: var(--spacing-2);
  list-style: none;
  margin: 0;
  padding: 0;
}

.header__nav-link {
  display: flex;
  align-items: center;
  padding: var(--spacing-2) var(--spacing-4);
  color: var(--color-text);
  text-decoration: none;
  font-size: var(--text-size-sm);
  font-weight: 500;
  border-radius: var(--radius-md);
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

.header__nav-link:hover {
  background-color: rgba(0, 0, 0, 0.04);
  color: var(--color-primary);
}

/* Header Actions */
.header__menu-toggle {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 44px;
  height: 44px;
  padding: 0;
  background: none;
  border: none;
  cursor: pointer;
  color: var(--color-text);
  border-radius: var(--radius-md);
  transition: background-color 0.2s ease;
}

.header__menu-toggle:hover {
  background-color: rgba(0, 0, 0, 0.04);
}

.header__menu-icon {
  display: flex;
  flex-direction: column;
  gap: 5px;
  width: 20px;
}

.header__menu-icon-line {
  display: block;
  width: 100%;
  height: 2px;
  background-color: currentColor;
  border-radius: 2px;
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
              opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.header__menu-toggle[aria-expanded="true"] .header__menu-icon-line:nth-child(1) {
  transform: translateY(7px) rotate(45deg);
}

.header__menu-toggle[aria-expanded="true"] .header__menu-icon-line:nth-child(2) {
  opacity: 0;
}

.header__menu-toggle[aria-expanded="true"] .header__menu-icon-line:nth-child(3) {
  transform: translateY(-7px) rotate(-45deg);
}

.header__actions {
  display: flex;
  align-items: center;
  gap: var(--spacing-2);
  margin-left: auto;
}

.header__action-link {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 44px;
  height: 44px;
  color: var(--color-text);
  text-decoration: none;
  border-radius: var(--radius-md);
  transition: background-color 0.2s ease, color 0.2s ease;
}

.header__action-link:hover {
  background-color: rgba(0, 0, 0, 0.04);
  color: var(--color-primary);
}

.header__icon {
  width: 22px;
  height: 22px;
}

.header__cart-count {
  position: absolute;
  top: 6px;
  right: 6px;
  min-width: 18px;
  height: 18px;
  padding: 0 5px;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: var(--color-primary);
  color: var(--color-background);
  font-size: 11px;
  font-weight: 600;
  border-radius: var(--radius-full);
  line-height: 1;
}

/* Mobile Drawer - Slide from Left */
.header__mobile-drawer {
  position: fixed;
  inset: 0;
  z-index: 1000;
  visibility: hidden;
  opacity: 0;
  transition: visibility 0.3s ease, opacity 0.3s ease;
}

.header__mobile-drawer[aria-hidden="false"] {
  visibility: visible;
  opacity: 1;
}

.header__mobile-backdrop {
  position: fixed;
  inset: 0;
  background-color: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.header__mobile-drawer[aria-hidden="false"] .header__mobile-backdrop {
  opacity: 1;
}

.header__mobile-panel {
  position: fixed;
  left: 0;
  top: 0;
  width: 85%;
  max-width: 380px;
  height: 100vh;
  height: 100dvh;
  background-color: var(--color-background);
  box-shadow: 4px 0 12px rgba(0, 0, 0, 0.15);
  display: flex;
  flex-direction: column;
  transform: translateX(-100%);
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  overflow-y: auto;
  z-index: 1001;
}

.header__mobile-drawer[aria-hidden="false"] .header__mobile-panel {
  transform: translateX(0);
}

.header__mobile-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--spacing-6);
  border-bottom: 1px solid var(--color-border);
}

.header__mobile-logo-text {
  font-size: var(--text-size-lg);
  font-weight: 600;
  color: var(--color-text);
}

.header__mobile-close {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 44px;
  height: 44px;
  padding: 0;
  background: none;
  border: none;
  cursor: pointer;
  color: var(--color-text);
  border-radius: var(--radius-md);
  transition: background-color 0.2s ease;
}

.header__mobile-close:hover {
  background-color: rgba(0, 0, 0, 0.04);
}

.header__mobile-nav {
  flex: 1;
  overflow-y: auto;
  padding: var(--spacing-4);
}

.header__mobile-nav-list {
  list-style: none;
  margin: 0;
  padding: 0;
}

.header__mobile-nav-list > li {
  margin-bottom: var(--spacing-1);
}

.header__mobile-nav-link {
  display: flex;
  align-items: center;
  gap: var(--spacing-3);
  padding: var(--spacing-4);
  color: var(--color-text);
  text-decoration: none;
  font-size: var(--text-size-base);
  font-weight: 500;
  border-radius: var(--radius-lg);
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

.header__mobile-nav-link:hover {
  background-color: rgba(0, 0, 0, 0.04);
}


.header__mobile-divider {
  margin-top: var(--spacing-6);
  padding-top: var(--spacing-6);
  border-top: 1px solid var(--color-border);
}

.header__mobile-nav-link--highlighted {
  background-color: rgba(0, 0, 0, 0.04);
}

/* Animations */
@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}


/* Scroll Behavior */
.header--hidden {
  transform: translateY(-100%);
}

/* Desktop Breakpoint */
@media screen and (min-width: 990px) {
  .header__menu-toggle {
    display: none;
  }
  
  .header__nav {
    display: flex;
  }
  
  .header__inner {
    padding: var(--spacing-2) 0;
  }
}

/* Tablet Breakpoint */
@media screen and (min-width: 750px) {
  .header__inner {
    gap: var(--spacing-12);
  }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  .header,
  .header__nav-link,
  .header__action-link,
  .header__mobile-panel,
  .header__mobile-backdrop {
    animation: none !important;
    transition: none !important;
  }
}
{% endstylesheet %}

{% javascript %}
class HeaderComponent {
  constructor() {
    this.header = document.querySelector('[data-header]');
    this.mobileToggle = document.querySelector('[data-mobile-menu-toggle]');
    this.mobileDrawer = document.querySelector('[data-mobile-drawer]');
    this.mobileBackdrop = document.querySelector('[data-mobile-backdrop]');
    this.mobileClose = document.querySelector('[data-mobile-close]');
    
    this.lastScrollY = window.scrollY;
    
    this.init();
  }
  
  init() {
    // Mobile menu handlers
    if (this.mobileToggle) {
      this.mobileToggle.addEventListener('click', () => this.toggleMobileMenu());
    }
    
    if (this.mobileClose) {
      this.mobileClose.addEventListener('click', () => this.closeMobileMenu());
    }
    
    if (this.mobileBackdrop) {
      this.mobileBackdrop.addEventListener('click', () => this.closeMobileMenu());
    }
    
    // Escape key handler
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && this.mobileDrawer?.getAttribute('aria-hidden') === 'false') {
        this.closeMobileMenu();
      }
    });
    
    // Prevent body scroll when mobile menu is open
    if (this.mobileDrawer) {
      const observer = new MutationObserver(() => {
        const isOpen = this.mobileDrawer.getAttribute('aria-hidden') === 'false';
        document.body.style.overflow = isOpen ? 'hidden' : '';
        document.documentElement.style.overflow = isOpen ? 'hidden' : '';
      });
      
      observer.observe(this.mobileDrawer, {
        attributes: true,
        attributeFilter: ['aria-hidden']
      });
    }
    
    // Scroll handler - always show on scroll up, hide on scroll down
    window.addEventListener('scroll', () => this.handleScroll(), { passive: true });
  }
  
  toggleMobileMenu() {
    const isExpanded = this.mobileToggle.getAttribute('aria-expanded') === 'true';
    
    if (isExpanded) {
      this.closeMobileMenu();
    } else {
      this.openMobileMenu();
    }
  }
  
  openMobileMenu() {
    if (!this.mobileDrawer) return;
    
    this.mobileToggle.setAttribute('aria-expanded', 'true');
    this.mobileDrawer.setAttribute('aria-hidden', 'false');
  }
  
  closeMobileMenu() {
    if (!this.mobileDrawer) return;
    
    this.mobileToggle.setAttribute('aria-expanded', 'false');
    this.mobileDrawer.setAttribute('aria-hidden', 'true');
  }
  
  handleScroll() {
    const currentScrollY = window.scrollY;
    
    // Add scrolled class for styling
    if (currentScrollY > 10) {
      this.header.classList.add('header--scrolled');
    } else {
      this.header.classList.remove('header--scrolled');
    }
    
    // Show on scroll up, hide on scroll down (when scrolled past 100px)
    if (currentScrollY > this.lastScrollY && currentScrollY > 100) {
      // Scrolling down - hide header
      this.header.classList.add('header--hidden');
    } else {
      // Scrolling up - show header
      this.header.classList.remove('header--hidden');
    }
    
    this.lastScrollY = currentScrollY;
  }
}

// Initialize when DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => new HeaderComponent());
} else {
  new HeaderComponent();
}
{% endjavascript %}

{% schema %}
{
  "name": "Header",
  "class": "section-header",
  "settings": [
    {
      "type": "header",
      "content": "Logo"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo image"
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "link_list",
      "id": "main_menu",
      "label": "Menu",
      "default": "main-menu"
    },
    {
      "type": "select",
      "id": "nav_position",
      "label": "Navigation position (Desktop)",
      "options": [
        {
          "value": "left",
          "label": "Left (near logo)"
        },
        {
          "value": "center",
          "label": "Center"
        }
      ],
      "default": "left",
      "info": "Choose navigation menu position on desktop"
    }
  ]
}
{% endschema %}
